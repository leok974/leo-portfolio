name: Smoke Test (Self-Hosted)
'on':
  workflow_dispatch:

jobs:
  ping:
    runs-on: [self-hosted, prod, deploy]
    steps:
      - name: Runner environment check
        run: |
          echo "ðŸ–¥ï¸  Runner hostname: $(hostname)"
          echo "ðŸ‘¤ User: $(whoami)"
          echo "ðŸ“‚ Working directory: $(pwd)"
          echo "ðŸ§ OS Info:"
          uname -a
      
      - name: Docker version check
        run: |
          echo "ðŸ³ Docker version:"
          docker version | head -n 20 || true
          
          echo ""
          echo "ðŸ³ Docker socket access:"
          ls -l /var/run/docker.sock || true
      
      - name: Docker ps check
        run: |
          echo "ðŸ“¦ Running containers:"
          docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" || true
      
      - name: Network connectivity
        run: |
          echo "ðŸŒ Testing network connectivity..."
          curl -sS -o /dev/null -w "api.leoklemet.com: %{http_code}\n" https://api.leoklemet.com/api/ready || true
          curl -sS -o /dev/null -w "github.com: %{http_code}\n" https://github.com || true
      
      - name: Workspace check
        run: |
          echo "ðŸ“ Workspace structure:"
          ls -la . || true
          
          echo ""
          echo "ðŸ“ Deploy folder (if exists):"
          ls -la deploy/ 2>/dev/null || echo "deploy/ not found (will be created on checkout)"
      
      - name: Success
        run: |
          echo "âœ… ============================================"
          echo "âœ…  Self-hosted runner is working!"
          echo "âœ… ============================================"
