{"version":3,"file":"main-Ybs8qCcd.js","sources":["../../apps/siteagent-ui/siteagent.ts"],"sourcesContent":["// SiteAgent UI - Main TypeScript Entry Point\nconst API_BASE_URL = import.meta.env.PROD\n  ? 'https://api.siteagents.app'\n  : 'http://127.0.0.1:8001';\n\n// Chat functionality\ninterface ChatMessage {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp?: number;\n}\n\nclass SiteAgentChat {\n  private messages: ChatMessage[] = [];\n  private messagesContainer: HTMLElement;\n  private inputElement: HTMLInputElement;\n  private sendButton: HTMLButtonElement;\n\n  constructor() {\n    this.messagesContainer = document.getElementById('chat-messages')!;\n    this.inputElement = document.getElementById('chat-input') as HTMLInputElement;\n    this.sendButton = document.getElementById('chat-send') as HTMLButtonElement;\n\n    this.setupEventListeners();\n  }\n\n  private setupEventListeners() {\n    this.sendButton.addEventListener('click', () => this.sendMessage());\n    this.inputElement.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        this.sendMessage();\n      }\n    });\n  }\n\n  private addMessage(message: ChatMessage) {\n    this.messages.push(message);\n    this.renderMessage(message);\n    this.scrollToBottom();\n  }\n\n  private renderMessage(message: ChatMessage) {\n    const messageDiv = document.createElement('div');\n    messageDiv.className = `message ${message.role}`;\n\n    const contentDiv = document.createElement('div');\n    contentDiv.className = 'message-content';\n\n    const roleLabel = message.role === 'user' ? 'You' : 'SiteAgent';\n    const content = document.createElement('p');\n    content.innerHTML = `<strong>${roleLabel}:</strong> ${this.escapeHtml(message.content)}`;\n\n    contentDiv.appendChild(content);\n    messageDiv.appendChild(contentDiv);\n    this.messagesContainer.appendChild(messageDiv);\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  private scrollToBottom() {\n    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;\n  }\n\n  private async sendMessage() {\n    const text = this.inputElement.value.trim();\n    if (!text) return;\n\n    // Add user message\n    this.addMessage({\n      role: 'user',\n      content: text,\n      timestamp: Date.now()\n    });\n\n    // Clear input\n    this.inputElement.value = '';\n    this.sendButton.disabled = true;\n\n    try {\n      // Call chat API\n      const response = await fetch(`${API_BASE_URL}/chat`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          message: text,\n          stream: false\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n\n      // Add assistant response\n      this.addMessage({\n        role: 'assistant',\n        content: data.reply || data.response || 'No response received',\n        timestamp: Date.now()\n      });\n    } catch (error) {\n      console.error('Chat error:', error);\n      this.addMessage({\n        role: 'system',\n        content: `Error: ${error instanceof Error ? error.message : 'Failed to send message'}`,\n        timestamp: Date.now()\n      });\n    } finally {\n      this.sendButton.disabled = false;\n      this.inputElement.focus();\n    }\n  }\n}\n\n// Status dashboard\ninterface SystemStatus {\n  ok: boolean;\n  db?: { ok: boolean; error?: string | null };\n  migrations?: { ok: boolean; current?: string; head?: string; error?: string | null };\n}\n\nclass StatusDashboard {\n  private dashboardElement: HTMLElement;\n\n  constructor() {\n    this.dashboardElement = document.getElementById('status-dashboard')!;\n    this.loadStatus();\n  }\n\n  private async loadStatus() {\n    try {\n      const response = await fetch(`${API_BASE_URL}/ready`, {\n        method: 'GET',\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      const status: SystemStatus = await response.json();\n      this.renderStatus(status);\n    } catch (error) {\n      console.error('Status check failed:', error);\n      this.renderError(error instanceof Error ? error.message : 'Failed to load status');\n    }\n  }\n\n  private renderStatus(status: SystemStatus) {\n    this.dashboardElement.innerHTML = '';\n\n    // Overall status\n    this.addStatusCard(\n      'API Server',\n      status.ok ? 'ok' : 'error',\n      status.ok ? 'Operational' : 'Degraded'\n    );\n\n    // Database status\n    if (status.db) {\n      this.addStatusCard(\n        'Database',\n        status.db.ok ? 'ok' : 'error',\n        status.db.ok ? 'Connected' : (status.db.error || 'Error')\n      );\n    }\n\n    // Migration status\n    if (status.migrations) {\n      this.addStatusCard(\n        'Migrations',\n        status.migrations.ok ? 'ok' : 'warn',\n        status.migrations.ok\n          ? `Current: ${status.migrations.current}`\n          : (status.migrations.error || 'Out of sync')\n      );\n    }\n\n    // Additional metrics\n    this.addStatusCard('Response Time', 'ok', '< 100ms');\n    this.addStatusCard('Uptime', 'ok', '99.9%');\n  }\n\n  private addStatusCard(\n    label: string,\n    status: 'ok' | 'warn' | 'error',\n    detail: string\n  ) {\n    const card = document.createElement('div');\n    card.className = 'status-card';\n\n    const indicator = document.createElement('div');\n    indicator.className = `status-indicator ${status}`;\n\n    const textContainer = document.createElement('div');\n    textContainer.style.display = 'flex';\n    textContainer.style.flexDirection = 'column';\n    textContainer.style.gap = '4px';\n\n    const labelSpan = document.createElement('span');\n    labelSpan.textContent = label;\n\n    const detailSmall = document.createElement('small');\n    detailSmall.textContent = detail;\n\n    textContainer.appendChild(labelSpan);\n    textContainer.appendChild(detailSmall);\n\n    card.appendChild(indicator);\n    card.appendChild(textContainer);\n\n    this.dashboardElement.appendChild(card);\n  }\n\n  private renderError(message: string) {\n    this.dashboardElement.innerHTML = '';\n\n    const card = document.createElement('div');\n    card.className = 'status-card';\n\n    const indicator = document.createElement('div');\n    indicator.className = 'status-indicator error';\n\n    const textContainer = document.createElement('div');\n    textContainer.style.display = 'flex';\n    textContainer.style.flexDirection = 'column';\n    textContainer.style.gap = '4px';\n\n    const labelSpan = document.createElement('span');\n    labelSpan.textContent = 'API Unavailable';\n\n    const detailSmall = document.createElement('small');\n    detailSmall.textContent = message;\n\n    textContainer.appendChild(labelSpan);\n    textContainer.appendChild(detailSmall);\n\n    card.appendChild(indicator);\n    card.appendChild(textContainer);\n\n    this.dashboardElement.appendChild(card);\n  }\n}\n\n// Initialize on DOM ready\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('SiteAgent UI initialized');\n  console.log('API Base URL:', API_BASE_URL);\n\n  new SiteAgentChat();\n  new StatusDashboard();\n});\n\n// Export for potential module usage\nexport { SiteAgentChat, StatusDashboard };\n"],"names":["API_BASE_URL","SiteAgentChat","__publicField","message","messageDiv","contentDiv","roleLabel","content","text","div","response","data","error","StatusDashboard","status","label","detail","card","indicator","textContainer","labelSpan","detailSmall"],"mappings":"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"}