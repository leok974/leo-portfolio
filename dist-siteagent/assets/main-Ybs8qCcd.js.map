{"version":3,"file":"main-Ybs8qCcd.js","sources":["../../apps/siteagent-ui/siteagent.ts"],"sourcesContent":["// SiteAgent UI - Main TypeScript Entry Point\r\nconst API_BASE_URL = import.meta.env.PROD\r\n  ? 'https://api.siteagents.app'\r\n  : 'http://127.0.0.1:8001';\r\n\r\n// Chat functionality\r\ninterface ChatMessage {\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp?: number;\r\n}\r\n\r\nclass SiteAgentChat {\r\n  private messages: ChatMessage[] = [];\r\n  private messagesContainer: HTMLElement;\r\n  private inputElement: HTMLInputElement;\r\n  private sendButton: HTMLButtonElement;\r\n\r\n  constructor() {\r\n    this.messagesContainer = document.getElementById('chat-messages')!;\r\n    this.inputElement = document.getElementById('chat-input') as HTMLInputElement;\r\n    this.sendButton = document.getElementById('chat-send') as HTMLButtonElement;\r\n\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  private setupEventListeners() {\r\n    this.sendButton.addEventListener('click', () => this.sendMessage());\r\n    this.inputElement.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        this.sendMessage();\r\n      }\r\n    });\r\n  }\r\n\r\n  private addMessage(message: ChatMessage) {\r\n    this.messages.push(message);\r\n    this.renderMessage(message);\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  private renderMessage(message: ChatMessage) {\r\n    const messageDiv = document.createElement('div');\r\n    messageDiv.className = `message ${message.role}`;\r\n\r\n    const contentDiv = document.createElement('div');\r\n    contentDiv.className = 'message-content';\r\n\r\n    const roleLabel = message.role === 'user' ? 'You' : 'SiteAgent';\r\n    const content = document.createElement('p');\r\n    content.innerHTML = `<strong>${roleLabel}:</strong> ${this.escapeHtml(message.content)}`;\r\n\r\n    contentDiv.appendChild(content);\r\n    messageDiv.appendChild(contentDiv);\r\n    this.messagesContainer.appendChild(messageDiv);\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  private scrollToBottom() {\r\n    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;\r\n  }\r\n\r\n  private async sendMessage() {\r\n    const text = this.inputElement.value.trim();\r\n    if (!text) return;\r\n\r\n    // Add user message\r\n    this.addMessage({\r\n      role: 'user',\r\n      content: text,\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    // Clear input\r\n    this.inputElement.value = '';\r\n    this.sendButton.disabled = true;\r\n\r\n    try {\r\n      // Call chat API\r\n      const response = await fetch(`${API_BASE_URL}/chat`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          message: text,\r\n          stream: false\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Add assistant response\r\n      this.addMessage({\r\n        role: 'assistant',\r\n        content: data.reply || data.response || 'No response received',\r\n        timestamp: Date.now()\r\n      });\r\n    } catch (error) {\r\n      console.error('Chat error:', error);\r\n      this.addMessage({\r\n        role: 'system',\r\n        content: `Error: ${error instanceof Error ? error.message : 'Failed to send message'}`,\r\n        timestamp: Date.now()\r\n      });\r\n    } finally {\r\n      this.sendButton.disabled = false;\r\n      this.inputElement.focus();\r\n    }\r\n  }\r\n}\r\n\r\n// Status dashboard\r\ninterface SystemStatus {\r\n  ok: boolean;\r\n  db?: { ok: boolean; error?: string | null };\r\n  migrations?: { ok: boolean; current?: string; head?: string; error?: string | null };\r\n}\r\n\r\nclass StatusDashboard {\r\n  private dashboardElement: HTMLElement;\r\n\r\n  constructor() {\r\n    this.dashboardElement = document.getElementById('status-dashboard')!;\r\n    this.loadStatus();\r\n  }\r\n\r\n  private async loadStatus() {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/ready`, {\r\n        method: 'GET',\r\n        credentials: 'include'\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      const status: SystemStatus = await response.json();\r\n      this.renderStatus(status);\r\n    } catch (error) {\r\n      console.error('Status check failed:', error);\r\n      this.renderError(error instanceof Error ? error.message : 'Failed to load status');\r\n    }\r\n  }\r\n\r\n  private renderStatus(status: SystemStatus) {\r\n    this.dashboardElement.innerHTML = '';\r\n\r\n    // Overall status\r\n    this.addStatusCard(\r\n      'API Server',\r\n      status.ok ? 'ok' : 'error',\r\n      status.ok ? 'Operational' : 'Degraded'\r\n    );\r\n\r\n    // Database status\r\n    if (status.db) {\r\n      this.addStatusCard(\r\n        'Database',\r\n        status.db.ok ? 'ok' : 'error',\r\n        status.db.ok ? 'Connected' : (status.db.error || 'Error')\r\n      );\r\n    }\r\n\r\n    // Migration status\r\n    if (status.migrations) {\r\n      this.addStatusCard(\r\n        'Migrations',\r\n        status.migrations.ok ? 'ok' : 'warn',\r\n        status.migrations.ok\r\n          ? `Current: ${status.migrations.current}`\r\n          : (status.migrations.error || 'Out of sync')\r\n      );\r\n    }\r\n\r\n    // Additional metrics\r\n    this.addStatusCard('Response Time', 'ok', '< 100ms');\r\n    this.addStatusCard('Uptime', 'ok', '99.9%');\r\n  }\r\n\r\n  private addStatusCard(\r\n    label: string,\r\n    status: 'ok' | 'warn' | 'error',\r\n    detail: string\r\n  ) {\r\n    const card = document.createElement('div');\r\n    card.className = 'status-card';\r\n\r\n    const indicator = document.createElement('div');\r\n    indicator.className = `status-indicator ${status}`;\r\n\r\n    const textContainer = document.createElement('div');\r\n    textContainer.style.display = 'flex';\r\n    textContainer.style.flexDirection = 'column';\r\n    textContainer.style.gap = '4px';\r\n\r\n    const labelSpan = document.createElement('span');\r\n    labelSpan.textContent = label;\r\n\r\n    const detailSmall = document.createElement('small');\r\n    detailSmall.textContent = detail;\r\n\r\n    textContainer.appendChild(labelSpan);\r\n    textContainer.appendChild(detailSmall);\r\n\r\n    card.appendChild(indicator);\r\n    card.appendChild(textContainer);\r\n\r\n    this.dashboardElement.appendChild(card);\r\n  }\r\n\r\n  private renderError(message: string) {\r\n    this.dashboardElement.innerHTML = '';\r\n\r\n    const card = document.createElement('div');\r\n    card.className = 'status-card';\r\n\r\n    const indicator = document.createElement('div');\r\n    indicator.className = 'status-indicator error';\r\n\r\n    const textContainer = document.createElement('div');\r\n    textContainer.style.display = 'flex';\r\n    textContainer.style.flexDirection = 'column';\r\n    textContainer.style.gap = '4px';\r\n\r\n    const labelSpan = document.createElement('span');\r\n    labelSpan.textContent = 'API Unavailable';\r\n\r\n    const detailSmall = document.createElement('small');\r\n    detailSmall.textContent = message;\r\n\r\n    textContainer.appendChild(labelSpan);\r\n    textContainer.appendChild(detailSmall);\r\n\r\n    card.appendChild(indicator);\r\n    card.appendChild(textContainer);\r\n\r\n    this.dashboardElement.appendChild(card);\r\n  }\r\n}\r\n\r\n// Initialize on DOM ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  console.log('SiteAgent UI initialized');\r\n  console.log('API Base URL:', API_BASE_URL);\r\n\r\n  new SiteAgentChat();\r\n  new StatusDashboard();\r\n});\r\n\r\n// Export for potential module usage\r\nexport { SiteAgentChat, StatusDashboard };\r\n"],"names":["API_BASE_URL","SiteAgentChat","__publicField","message","messageDiv","contentDiv","roleLabel","content","text","div","response","data","error","StatusDashboard","status","label","detail","card","indicator","textContainer","labelSpan","detailSmall"],"mappings":"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"}