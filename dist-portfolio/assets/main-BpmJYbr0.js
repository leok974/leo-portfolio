var Xe=Object.defineProperty;var Ze=(t,e,n)=>e in t?Xe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var H=(t,e,n)=>Ze(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const et="layout:update",Pe={recipe:null};async function K(){try{const t=await fetch("/api/layout",{credentials:"include"});if(!t.ok)return;const e=await t.json();Pe.recipe=e,nt(e),window.dispatchEvent(new CustomEvent(et,{detail:e}))}catch{}}function tt(){return Pe.recipe}function nt(t){Object.entries(t.cards).forEach(([e,n])=>{const o=document.querySelector(`[data-card="${e}"]`);if(!o){console.debug(`Card not found: ${e}`);return}n.order!==void 0&&(o.style.order=String(n.order)),n.size?o.setAttribute("data-size",n.size):o.removeAttribute("data-size"),n.hidden?o.setAttribute("hidden",""):o.removeAttribute("hidden")})}const Oe="admin:enabled";function ot(){const t=new URL(location.href);if(t.searchParams.has("admin")){const e=t.searchParams.get("admin"),n=e===""||e==="1"||(e==null?void 0:e.toLowerCase())==="true";localStorage.setItem(Oe,n?"1":"0"),n&&history.replaceState(null,"",t.pathname+t.hash)}}function rt(){return!1&&localStorage.getItem(Oe)==="1"}async function st(){try{const t=await fetch("/api/auth/me",{credentials:"include"});return t.ok?await t.json():null}catch{return null}}function it(t){var n,o;const e=((n=t==null?void 0:t.user)==null?void 0:n.roles)||[];return((o=t==null?void 0:t.user)==null?void 0:o.is_admin)===!0||e.includes("admin")||e.includes("owner")}let W=null;async function pe(){if(rt())return!0;const t=Date.now();if(W&&t-W.at<1e4)return W.val;const e=await st(),n=it(e);return W={at:t,val:n},n}function De(){return document.cookie.split(";").map(e=>e.trim()).some(e=>e.startsWith("sa_dev="))}function at(){if(!De()){console.log("[Dev Overlay] Not enabled (no sa_dev cookie found)");return}console.log("[Dev Overlay] Enabled - mounting badge");const t=document.createElement("div");t.dataset.testid="dev-overlay",t.textContent="DEV",t.style.cssText=`
    position: fixed;
    right: 12px;
    bottom: 12px;
    padding: 6px 8px;
    border-radius: 6px;
    background: #111;
    color: #fff;
    font: 600 12px/1 system-ui;
    z-index: 99999;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    transition: transform 0.2s;
  `,t.addEventListener("mouseenter",()=>{t.style.transform="scale(1.1)"}),t.addEventListener("mouseleave",()=>{t.style.transform="scale(1)"}),t.addEventListener("click",async()=>{try{const n=await(await fetch("/agent/dev/status")).json();alert(`Dev Overlay Status:
${JSON.stringify(n,null,2)}`)}catch(e){console.error("[Dev Overlay] Failed to fetch status:",e)}}),document.body.appendChild(t),console.log("[Dev Overlay] Badge mounted successfully")}async function lt(t="dev"){try{const e=await fetch("/agent/dev/enable",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)return console.error("[Dev Overlay] Enable failed:",e.status),!1;const n=await e.json();return console.log("[Dev Overlay] Enabled:",n),window.location.reload(),!0}catch(e){return console.error("[Dev Overlay] Enable error:",e),!1}}if(typeof window<"u"){const e=new URLSearchParams(window.location.search).get("dev_overlay");e&&!De()&&(console.log("[Dev Overlay] Auto-enabling from URL parameter"),lt(e))}class ct{constructor(){H(this,"projects",[]);H(this,"currentFilter","all");H(this,"gridContainer");H(this,"loadingElement",null);H(this,"emptyElement");H(this,"observer");if(this.gridContainer=document.getElementById("portfolio-grid"),this.emptyElement=document.getElementById("portfolio-empty"),!this.gridContainer||!this.emptyElement){console.warn("Portfolio elements not found");return}this.loadingElement=this.gridContainer.querySelector(".portfolio-loading"),this.observer=new IntersectionObserver(e=>{e.forEach(n=>{if(n.isIntersecting){const o=n.target,r=o.dataset.src;r&&(o.src=r,o.removeAttribute("data-src"),this.observer.unobserve(o))}})},{rootMargin:"50px"}),this.setupFilterListeners(),this.loadProjects()}setupFilterListeners(){const e=document.querySelectorAll(".filter-btn");e.forEach(n=>{n.addEventListener("click",o=>{const r=o.currentTarget,s=r.dataset.filter||"all";e.forEach(a=>a.classList.remove("active")),r.classList.add("active"),this.currentFilter=s,this.renderProjects()})})}async loadProjects(){try{const e=await fetch("/projects.json");if(!e.ok)throw new Error(`Failed to fetch projects: ${e.status}`);const n=await e.json();this.projects=Object.values(n),console.log(`Loaded ${this.projects.length} projects`),this.renderProjects()}catch(e){console.error("Error loading projects:",e),this.showEmpty()}}renderProjects(){if(!this.gridContainer)return;this.gridContainer.innerHTML="";const e=this.currentFilter==="all"?this.projects:this.projects.filter(o=>o.tags.some(r=>r.toLowerCase().includes(this.currentFilter.toLowerCase())));if(console.log(`Rendering ${e.length} projects (filter: ${this.currentFilter})`),e.length===0){this.showEmpty();return}this.emptyElement&&(this.emptyElement.style.display="none"),e.forEach((o,r)=>{const s=this.createProjectCard(o,r);this.gridContainer.appendChild(s)}),this.gridContainer.querySelectorAll("img[data-src]").forEach(o=>this.observer.observe(o))}createProjectCard(e,n){const o=document.createElement("div");o.className="project-card",o.style.animationDelay=`${n*.05}s`,o.setAttribute("data-card",e.slug);const r=e.thumbnail||"/placeholder.svg",s=this.escapeHtml(e.title),a=this.escapeHtml(e.description||e.problem||"No description available."),c=e.tags.slice(0,4).map(l=>`<span class="project-tag">${this.escapeHtml(l)}</span>`).join("");let _="";return e.demo&&(_=`
        <a href="${e.demo}" target="_blank" rel="noopener noreferrer" class="project-link">
          View Project â†’
        </a>
      `),o.innerHTML=`
      <div class="project-thumbnail">
        <img data-src="${r}" alt="${s}" loading="lazy" />
      </div>
      <div class="project-content">
        <h3 class="project-title">${s}</h3>
        ${c?`<div class="project-tags">${c}</div>`:""}
        <p class="project-description">${a}</p>
        ${_}
      </div>
    `,o}showEmpty(){!this.gridContainer||!this.emptyElement||(this.gridContainer.innerHTML="",this.emptyElement.style.display="block")}escapeHtml(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{console.log("Portfolio UI initialized"),new ct});ot();K();const oe="https://calendly.com/leoklemet-pa";function _t(){if(window.__CALENDLY_STARTED__)return;window.__CALENDLY_STARTED__=!0;const t=document.querySelector(".calendly-inline-widget");t&&t.setAttribute("data-url",oe),typeof window.Calendly<"u"&&window.Calendly.initInlineWidget({url:oe,parentElement:document.querySelector(".calendly-inline-widget"),prefill:{},utm:{}})}document.addEventListener("DOMContentLoaded",()=>{_t();const t=document.getElementById("calendly-popup-btn");t&&t.addEventListener("click",n=>(n.preventDefault(),typeof window.Calendly<"u"&&window.Calendly.initPopupWidget({url:oe}),!1));const e=n=>{const o=document.getElementById(n);o&&o.addEventListener("click",async()=>{try{const r=await fetch("/resume/copy.txt?limit=2600",{credentials:"include"});if(!r.ok)throw new Error(`Failed to fetch resume: ${r.status}`);const s=await r.text();await navigator.clipboard.writeText(s);const a=o.innerHTML,c=o.querySelector(".contact-icon");if(c){c.textContent="âœ…";const _=o.querySelector("span:not(.contact-icon)");_&&(_.textContent="Copied!")}else o.innerHTML="âœ… Copied!";setTimeout(()=>{o.innerHTML=a},2e3)}catch(r){console.error("Failed to copy resume:",r);const s=o.querySelector(".contact-icon");s?s.textContent="âŒ":o.innerHTML="âŒ Failed",setTimeout(()=>{s?s.textContent="ðŸ“‹":o.innerHTML="ðŸ“‹ Copy for LinkedIn"},2e3)}})};e("copy-linkedin-btn"),e("copy-linkedin-btn-footer")});window.addEventListener("layout:update",t=>{console.log("Layout loaded:",t.detail)});at();console.log("Portfolio shell initialized");var Z,b,He,j,he,Ne,je,Ie,ce,re,se,B={},Me=[],dt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ee=Array.isArray;function $(t,e){for(var n in e)t[n]=e[n];return t}function _e(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function ut(t,e,n){var o,r,s,a={};for(s in e)s=="key"?o=e[s]:s=="ref"?r=e[s]:a[s]=e[s];if(arguments.length>2&&(a.children=arguments.length>3?Z.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)a[s]===void 0&&(a[s]=t.defaultProps[s]);return V(t,a,o,r,null)}function V(t,e,n,o,r){var s={type:t,props:e,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++He,__i:-1,__u:0};return r==null&&b.vnode!=null&&b.vnode(s),s}function q(t){return t.children}function Y(t,e){this.props=t,this.context=e}function U(t,e){if(e==null)return t.__?U(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?U(t):null}function Fe(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Fe(t)}}function me(t){(!t.__d&&(t.__d=!0)&&j.push(t)&&!Q.__r++||he!=b.debounceRendering)&&((he=b.debounceRendering)||Ne)(Q)}function Q(){for(var t,e,n,o,r,s,a,c=1;j.length;)j.length>c&&j.sort(je),t=j.shift(),c=j.length,t.__d&&(n=void 0,o=void 0,r=(o=(e=t).__v).__e,s=[],a=[],e.__P&&((n=$({},o)).__v=o.__v+1,b.vnode&&b.vnode(n),de(e.__P,n,o,e.__n,e.__P.namespaceURI,32&o.__u?[r]:null,s,r??U(o),!!(32&o.__u),a),n.__v=o.__v,n.__.__k[n.__i]=n,Re(s,n,a),o.__e=o.__=null,n.__e!=r&&Fe(n)));Q.__r=0}function Ue(t,e,n,o,r,s,a,c,_,l,p){var i,u,d,w,C,E,g,y=o&&o.__k||Me,f=e.length;for(_=ft(n,e,y,_,f),i=0;i<f;i++)(d=n.__k[i])!=null&&(u=d.__i==-1?B:y[d.__i]||B,d.__i=i,E=de(t,d,u,r,s,a,c,_,l,p),w=d.__e,d.ref&&u.ref!=d.ref&&(u.ref&&ue(u.ref,null,d),p.push(d.ref,d.__c||w,d)),C==null&&w!=null&&(C=w),(g=!!(4&d.__u))||u.__k===d.__k?_=Be(d,_,t,g):typeof d.type=="function"&&E!==void 0?_=E:w&&(_=w.nextSibling),d.__u&=-7);return n.__e=C,_}function ft(t,e,n,o,r){var s,a,c,_,l,p=n.length,i=p,u=0;for(t.__k=new Array(r),s=0;s<r;s++)(a=e[s])!=null&&typeof a!="boolean"&&typeof a!="function"?(_=s+u,(a=t.__k[s]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?V(null,a,null,null,null):ee(a)?V(q,{children:a},null,null,null):a.constructor==null&&a.__b>0?V(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=t,a.__b=t.__b+1,c=null,(l=a.__i=pt(a,n,_,i))!=-1&&(i--,(c=n[l])&&(c.__u|=2)),c==null||c.__v==null?(l==-1&&(r>p?u--:r<p&&u++),typeof a.type!="function"&&(a.__u|=4)):l!=_&&(l==_-1?u--:l==_+1?u++:(l>_?u--:u++,a.__u|=4))):t.__k[s]=null;if(i)for(s=0;s<p;s++)(c=n[s])!=null&&!(2&c.__u)&&(c.__e==o&&(o=U(c)),We(c,c));return o}function Be(t,e,n,o){var r,s;if(typeof t.type=="function"){for(r=t.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=t,e=Be(r[s],e,n,o));return e}t.__e!=e&&(o&&(e&&t.type&&!e.parentNode&&(e=U(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function pt(t,e,n,o){var r,s,a,c=t.key,_=t.type,l=e[n],p=l!=null&&(2&l.__u)==0;if(l===null&&t.key==null||p&&c==l.key&&_==l.type)return n;if(o>(p?1:0)){for(r=n-1,s=n+1;r>=0||s<e.length;)if((l=e[a=r>=0?r--:s++])!=null&&!(2&l.__u)&&c==l.key&&_==l.type)return a}return-1}function ye(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||dt.test(e)?n:n+"px"}function z(t,e,n,o,r){var s,a;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof o=="string"&&(t.style.cssText=o=""),o)for(e in o)n&&e in n||ye(t.style,e,"");if(n)for(e in n)o&&n[e]==o[e]||ye(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(Ie,"$1")),a=e.toLowerCase(),e=a in t||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?o?n.u=o.u:(n.u=ce,t.addEventListener(e,s?se:re,s)):t.removeEventListener(e,s?se:re,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function ge(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ce++;else if(e.t<n.u)return;return n(b.event?b.event(e):e)}}}function de(t,e,n,o,r,s,a,c,_,l){var p,i,u,d,w,C,E,g,y,f,v,A,T,I,D,P,M,S=e.type;if(e.constructor!=null)return null;128&n.__u&&(_=!!(32&n.__u),s=[c=e.__e=n.__e]),(p=b.__b)&&p(e);e:if(typeof S=="function")try{if(g=e.props,y="prototype"in S&&S.prototype.render,f=(p=S.contextType)&&o[p.__c],v=p?f?f.props.value:p.__:o,n.__c?E=(i=e.__c=n.__c).__=i.__E:(y?e.__c=i=new S(g,v):(e.__c=i=new Y(g,v),i.constructor=S,i.render=mt),f&&f.sub(i),i.props=g,i.state||(i.state={}),i.context=v,i.__n=o,u=i.__d=!0,i.__h=[],i._sb=[]),y&&i.__s==null&&(i.__s=i.state),y&&S.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=$({},i.__s)),$(i.__s,S.getDerivedStateFromProps(g,i.__s))),d=i.props,w=i.state,i.__v=e,u)y&&S.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),y&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(y&&S.getDerivedStateFromProps==null&&g!==d&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(g,v),!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(g,i.__s,v)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(i.props=g,i.state=i.__s,i.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(h){h&&(h.__=e)}),A=0;A<i._sb.length;A++)i.__h.push(i._sb[A]);i._sb=[],i.__h.length&&a.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(g,i.__s,v),y&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(d,w,C)})}if(i.context=v,i.props=g,i.__P=t,i.__e=!1,T=b.__r,I=0,y){for(i.state=i.__s,i.__d=!1,T&&T(e),p=i.render(i.props,i.state,i.context),D=0;D<i._sb.length;D++)i.__h.push(i._sb[D]);i._sb=[]}else do i.__d=!1,T&&T(e),p=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++I<25);i.state=i.__s,i.getChildContext!=null&&(o=$($({},o),i.getChildContext())),y&&!u&&i.getSnapshotBeforeUpdate!=null&&(C=i.getSnapshotBeforeUpdate(d,w)),P=p,p!=null&&p.type===q&&p.key==null&&(P=qe(p.props.children)),c=Ue(t,ee(P)?P:[P],e,n,o,r,s,a,c,_,l),i.base=e.__e,e.__u&=-161,i.__h.length&&a.push(i),E&&(i.__E=i.__=null)}catch(h){if(e.__v=null,_||s!=null)if(h.then){for(e.__u|=_?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;s[s.indexOf(c)]=null,e.__e=c}else{for(M=s.length;M--;)_e(s[M]);ie(e)}else e.__e=n.__e,e.__k=n.__k,h.then||ie(e);b.__e(h,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):c=e.__e=ht(n.__e,e,n,o,r,s,a,_,l);return(p=b.diffed)&&p(e),128&e.__u?void 0:c}function ie(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(ie)}function Re(t,e,n){for(var o=0;o<n.length;o++)ue(n[o],n[++o],n[++o]);b.__c&&b.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(s){s.call(r)})}catch(s){b.__e(s,r.__v)}})}function qe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ee(t)?t.map(qe):$({},t)}function ht(t,e,n,o,r,s,a,c,_){var l,p,i,u,d,w,C,E=n.props,g=e.props,y=e.type;if(y=="svg"?r="http://www.w3.org/2000/svg":y=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((d=s[l])&&"setAttribute"in d==!!y&&(y?d.localName==y:d.nodeType==3)){t=d,s[l]=null;break}}if(t==null){if(y==null)return document.createTextNode(g);t=document.createElementNS(r,y,g.is&&g),c&&(b.__m&&b.__m(e,s),c=!1),s=null}if(y==null)E===g||c&&t.data==g||(t.data=g);else{if(s=s&&Z.call(t.childNodes),E=n.props||B,!c&&s!=null)for(E={},l=0;l<t.attributes.length;l++)E[(d=t.attributes[l]).name]=d.value;for(l in E)if(d=E[l],l!="children"){if(l=="dangerouslySetInnerHTML")i=d;else if(!(l in g)){if(l=="value"&&"defaultValue"in g||l=="checked"&&"defaultChecked"in g)continue;z(t,l,null,d,r)}}for(l in g)d=g[l],l=="children"?u=d:l=="dangerouslySetInnerHTML"?p=d:l=="value"?w=d:l=="checked"?C=d:c&&typeof d!="function"||E[l]===d||z(t,l,d,E[l],r);if(p)c||i&&(p.__html==i.__html||p.__html==t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(i&&(t.innerHTML=""),Ue(e.type=="template"?t.content:t,ee(u)?u:[u],e,n,o,y=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,a,s?s[0]:n.__k&&U(n,0),c,_),s!=null)for(l=s.length;l--;)_e(s[l]);c||(l="value",y=="progress"&&w==null?t.removeAttribute("value"):w!=null&&(w!==t[l]||y=="progress"&&!w||y=="option"&&w!=E[l])&&z(t,l,w,E[l],r),l="checked",C!=null&&C!=t[l]&&z(t,l,C,E[l],r))}return t}function ue(t,e,n){try{if(typeof t=="function"){var o=typeof t.__u=="function";o&&t.__u(),o&&e==null||(t.__u=t(e))}else t.current=e}catch(r){b.__e(r,n)}}function We(t,e,n){var o,r;if(b.unmount&&b.unmount(t),(o=t.ref)&&(o.current&&o.current!=t.__e||ue(o,null,e)),(o=t.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(s){b.__e(s,e)}o.base=o.__P=null}if(o=t.__k)for(r=0;r<o.length;r++)o[r]&&We(o[r],e,n||typeof t.type!="function");n||_e(t.__e),t.__c=t.__=t.__e=void 0}function mt(t,e,n){return this.constructor(t,n)}function ze(t,e,n){var o,r,s,a;e==document&&(e=document.documentElement),b.__&&b.__(t,e),r=(o=!1)?null:e.__k,s=[],a=[],de(e,t=e.__k=ut(q,null,[t]),r||B,B,e.namespaceURI,r?null:e.firstChild?Z.call(e.childNodes):null,s,r?r.__e:e.firstChild,o,a),Re(s,t,a)}Z=Me.slice,b={__e:function(t,e,n,o){for(var r,s,a;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(t)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,o||{}),a=r.__d),a)return r.__E=r}catch(c){t=c}throw t}},He=0,Y.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=$({},this.state),typeof t=="function"&&(t=t($({},n),this.props)),t&&$(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),me(this))},Y.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),me(this))},Y.prototype.render=q,j=[],Ne=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,je=function(t,e){return t.__v.__b-e.__v.__b},Q.__r=0,Ie=/(PointerCapture)$|Capture$/i,ce=0,re=ge(!1),se=ge(!0);var yt=0;function m(t,e,n,o,r,s){e||(e={});var a,c,_=e;if("ref"in _)for(c in _={},e)c=="ref"?a=e[c]:_[c]=e[c];var l={type:t,props:_,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--yt,__i:-1,__u:0,__source:r,__self:s};if(typeof t=="function"&&(a=t.defaultProps))for(c in a)_[c]===void 0&&(_[c]=a[c]);return b.vnode&&b.vnode(l),l}var R,k,te,ve,X=0,Ke=[],x=b,be=x.__b,we=x.__r,Ee=x.diffed,ke=x.__c,xe=x.unmount,Ce=x.__;function fe(t,e){x.__h&&x.__h(k,t,X||e),X=0;var n=k.__H||(k.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function N(t){return X=1,gt(Je,t)}function gt(t,e,n){var o=fe(R++,2);if(o.t=t,!o.__c&&(o.__=[Je(void 0,e),function(c){var _=o.__N?o.__N[0]:o.__[0],l=o.t(_,c);_!==l&&(o.__N=[l,o.__[1]],o.__c.setState({}))}],o.__c=k,!k.__f)){var r=function(c,_,l){if(!o.__c.__H)return!0;var p=o.__c.__H.__.filter(function(u){return!!u.__c});if(p.every(function(u){return!u.__N}))return!s||s.call(this,c,_,l);var i=o.__c.props!==c;return p.forEach(function(u){if(u.__N){var d=u.__[0];u.__=u.__N,u.__N=void 0,d!==u.__[0]&&(i=!0)}}),s&&s.call(this,c,_,l)||i};k.__f=!0;var s=k.shouldComponentUpdate,a=k.componentWillUpdate;k.componentWillUpdate=function(c,_,l){if(this.__e){var p=s;s=void 0,r(c,_,l),s=p}a&&a.call(this,c,_,l)},k.shouldComponentUpdate=r}return o.__N||o.__}function J(t,e){var n=fe(R++,3);!x.__s&&Ye(n.__H,e)&&(n.__=t,n.u=e,k.__H.__h.push(n))}function Ve(t){return X=5,vt(function(){return{current:t}},[])}function vt(t,e){var n=fe(R++,7);return Ye(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function bt(){for(var t;t=Ke.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(G),t.__H.__h.forEach(ae),t.__H.__h=[]}catch(e){t.__H.__h=[],x.__e(e,t.__v)}}x.__b=function(t){k=null,be&&be(t)},x.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Ce&&Ce(t,e)},x.__r=function(t){we&&we(t),R=0;var e=(k=t.__c).__H;e&&(te===k?(e.__h=[],k.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(G),e.__h.forEach(ae),e.__h=[],R=0)),te=k},x.diffed=function(t){Ee&&Ee(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ke.push(e)!==1&&ve===x.requestAnimationFrame||((ve=x.requestAnimationFrame)||wt)(bt)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),te=k=null},x.__c=function(t,e){e.some(function(n){try{n.__h.forEach(G),n.__h=n.__h.filter(function(o){return!o.__||ae(o)})}catch(o){e.some(function(r){r.__h&&(r.__h=[])}),e=[],x.__e(o,n.__v)}}),ke&&ke(t,e)},x.unmount=function(t){xe&&xe(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{G(o)}catch(r){e=r}}),n.__H=void 0,e&&x.__e(e,n.__v))};var Le=typeof requestAnimationFrame=="function";function wt(t){var e,n=function(){clearTimeout(o),Le&&cancelAnimationFrame(e),setTimeout(t)},o=setTimeout(n,35);Le&&(e=requestAnimationFrame(n))}function G(t){var e=k,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),k=e}function ae(t){var e=k;t.__c=t.__(),k=e}function Ye(t,e){return!t||t.length!==e.length||e.some(function(n,o){return n!==t[o]})}function Je(t,e){return typeof e=="function"?e(t):e}function Et(){const t=Ve(null);return J(()=>{const e="calendly-widget-js";if(!document.getElementById(e)){const o=document.createElement("script");o.id=e,o.src="https://assets.calendly.com/assets/external/widget.js",o.async=!0,document.body.appendChild(o)}const n=o=>{try{const r=o.data,s=typeof r=="string"?JSON.parse(r):r;s&&s.event==="calendly:frameHeight"&&Number(s.payload)&&t.current&&(t.current.style.height=s.payload+"px")}catch{}};return window.addEventListener("message",n),()=>window.removeEventListener("message",n)},[]),m("section",{id:"contact",class:"contact-section",children:[m("h2",{class:"section-title",children:"Contact"}),m("div",{class:"cal-wrap",children:m("div",{ref:t,id:"calendly",class:"calendly-inline-widget","data-url":"https://calendly.com/leoklemet/30min","data-testid":"calendly"})})]})}const Se=document.getElementById("contact-root");Se&&(ze(m(Et,{}),Se),console.log("Contact component initialized"));const Ge="chatDock:collapsed";function le(t){const e=document.getElementById("chat-dock"),n=document.getElementById("dock-toggle"),o=document.getElementById("dock-tab");if(!e)return;e.classList.toggle("collapsed",t);const r=!t;e.setAttribute("aria-expanded",String(r)),n&&(n.setAttribute("aria-expanded",String(r)),n.setAttribute("title",t?"Expand (C)":"Collapse (C)")),o&&o.setAttribute("aria-expanded",String(r));try{localStorage.setItem(Ge,t?"1":"0")}catch(s){console.warn("Could not persist dock state:",s)}!t&&n&&n.focus()}function ne(){const t=document.getElementById("chat-dock");if(!t)return;const e=t.classList.contains("collapsed");le(!e)}function kt(){let t=!1;try{t=localStorage.getItem(Ge)==="1"}catch{}le(t);const e=document.getElementById("dock-toggle");e&&e.addEventListener("click",ne);const n=document.getElementById("dock-tab");n&&n.addEventListener("click",ne),window.addEventListener("keydown",o=>{const r=o.target,s=r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable;o.key.toLowerCase()==="c"&&!o.altKey&&!o.ctrlKey&&!o.metaKey&&!s&&(o.preventDefault(),ne()),o.key==="Escape"&&!s&&le(!0)})}function xt(t){return t.currentTarget.value}function Ct(){const e=new URL(window.location.href).searchParams.get("layout");return e==="1"?!0:e!=="0"}const $e="layout:update",Qe="";function L(){return Date.now()}function Ae(t){return new Date(t).toLocaleTimeString()}async function Lt(t){var o,r,s;const e=await fetch(`${Qe}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t}),credentials:"include"});if(!e.ok)throw new Error(`chat failed: ${e.status}`);const n=await e.json();return n.content||((s=(r=(o=n.choices)==null?void 0:o[0])==null?void 0:r.message)==null?void 0:s.content)||"No response"}async function St(t,{onDelta:e,onDone:n,onError:o}){var _,l,p,i;const r=await fetch(`${Qe}/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t}),credentials:"include"});if(!r.ok||!r.body){o(new Error(`stream failed: ${r.status}`));return}const s=r.body.getReader(),a=new TextDecoder;let c="";try{for(;;){const{value:u,done:d}=await s.read();if(d)break;c+=a.decode(u,{stream:!0});let w;for(;(w=c.indexOf(`

`))>=0;){const C=c.slice(0,w);c=c.slice(w+2);const E=C.split(`
`).find(y=>y.startsWith("data:"));if(!E)continue;const g=E.slice(5).trim();if(g==="[DONE]"){n();return}try{const y=JSON.parse(g),f=((_=y.delta)==null?void 0:_.content)||((i=(p=(l=y.choices)==null?void 0:l[0])==null?void 0:p.delta)==null?void 0:i.content)||"";if(f&&e(f),y.done){n();return}}catch{e(g)}}}n()}catch(u){o(u)}}function $t(){const[t,e]=N(tt()),[n,o]=N([{role:"system",text:"Assistant ready. Type below and press Enter.",ts:L()}]),[r,s]=N(""),[a,c]=N(!1),[_,l]=N(!1),[p,i]=N(!0),[u,d]=N(!1),w=Ve(null);J(()=>{(async()=>l(await pe()))();const f=async()=>l(await pe());return window.addEventListener("focus",f),()=>window.removeEventListener("focus",f)},[]),J(()=>{const f=v=>e(v.detail);return window.addEventListener($e,f),()=>window.removeEventListener($e,f)},[]),J(()=>{const f=w.current;f&&(f.scrollTop=f.scrollHeight)},[n]);async function C(f){var D,P,M,S;const v=f.trim();if(!v)return;if(u){o(h=>[...h,{role:"event",text:"[error] Assistant API is offline. Please try again later.",ts:L()}]);return}o(h=>[...h,{role:"user",text:v,ts:L()}]),s(""),c(!0);const A=n.filter(h=>h.role==="user"||h.role==="assistant").slice(-5).map(h=>({role:h.role,content:h.text}));A.push({role:"user",content:v});let T=!1,I="";try{await St(A,{onDelta:h=>{T=!0,I+=h,o(O=>{const F=O[O.length-1];return F&&F.role==="assistant"&&F.ts>L()-5e3?[...O.slice(0,-1),{...F,text:I}]:[...O,{role:"assistant",text:I,ts:L()}]})},onDone:()=>{c(!1),d(!1)},onError:h=>{console.error("[chat] stream error:",h)}})}catch(h){console.warn("[chat] streaming failed, trying non-stream:",h)}if(!T){try{const h=await Lt(A);o(O=>[...O,{role:"assistant",text:h,ts:L()}]),d(!1)}catch(h){const O=(D=h==null?void 0:h.message)!=null&&D.includes("Failed to fetch")||(P=h==null?void 0:h.message)!=null&&P.includes("NetworkError")?"[error] Cannot reach assistant API - please check connection":`[error] ${String(h)}`;o(F=>[...F,{role:"event",text:O,ts:L()}]),((M=h==null?void 0:h.message)!=null&&M.includes("Failed to fetch")||(S=h==null?void 0:h.message)!=null&&S.includes("NetworkError"))&&d(!0)}c(!1)}}function E(f){f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),C(r))}async function g(){try{const f=await fetch("/api/layout/autotune",{method:"POST",credentials:"include"});if(!f.ok){o(v=>[...v,{role:"event",text:`[autotune] ${f.status} ${f.statusText}`,ts:L()}]);return}o(v=>[...v,{role:"event",text:"[autotune] layout optimized",ts:L()}]),await K()}catch(f){o(v=>[...v,{role:"event",text:`[autotune] error: ${String(f)}`,ts:L()}])}}async function y(){try{const f=await fetch("/api/layout/reset",{method:"POST",credentials:"include"});if(!f.ok){o(v=>[...v,{role:"event",text:`[reset] ${f.status} ${f.statusText}`,ts:L()}]);return}o(v=>[...v,{role:"event",text:"[reset] layout reset to default",ts:L()}]),await K()}catch(f){o(v=>[...v,{role:"event",text:`[reset] error: ${String(f)}`,ts:L()}])}}return m("div",{id:"chat-dock",class:`assistant-panel${p?"":" hidden"}`,"data-testid":"chat-dock",role:"region","aria-label":"Portfolio Assistant","aria-expanded":"true",children:[m("header",{class:"dock-head",children:[m("div",{style:"display:flex; align-items:center; gap:.5rem;",children:[m("strong",{style:"font-weight:600;",children:"Chat"}),_&&m("span",{class:"asst-badge-admin",children:"admin"}),u&&m("span",{class:"asst-badge-offline",title:"Assistant API is offline",style:"background:#ef4444; color:white; padding:2px 6px; border-radius:4px; font-size:11px; font-weight:600;",children:"offline"})]}),m("div",{class:"asst-controls",style:"display:flex; gap:.25rem;",children:[_&&m(q,{children:[m("button",{class:"btn-sm",onClick:g,title:"Admin only: Autotune layout","data-testid":"btn-autotune",children:"Autotune"}),m("button",{class:"btn-sm",onClick:y,title:"Admin only: Reset layout","data-testid":"btn-reset",children:"Reset"})]}),m("button",{id:"dock-toggle",type:"button",class:"dock-btn btn-sm","aria-controls":"assistant-panel","aria-expanded":"true",title:"Collapse (C)","data-testid":"dock-toggle",children:"â–¸"})]})]}),m("div",{class:"dock-body",children:[m("div",{ref:w,class:"asst-log","data-testid":"assistant-log",children:[n.map((f,v)=>m("div",{class:`row ${f.role}`,children:[m("span",{class:"ts",children:Ae(f.ts)}),m("span",{class:"bubble",children:f.text})]},v)),a&&m("div",{class:"row event",children:[m("span",{class:"ts",children:Ae(L())}),m("span",{class:"bubble",children:"â€¦streaming"})]})]}),m("div",{class:"asst-compose",children:[m("textarea",{"aria-label":"Message",placeholder:u?"Assistant offline - cannot send messages":"Type a messageâ€¦",value:r,onInput:f=>s(xt(f)),onKeyDown:f=>E(f),rows:1,disabled:u,style:u?{opacity:.5,cursor:"not-allowed"}:{}}),m("button",{class:"btn",onClick:()=>void C(r),disabled:a||u,"data-testid":"assistant-send",title:u?"API is offline":void 0,children:a?"Sendingâ€¦":u?"Offline":"Send"})]}),Ct()&&m("details",{class:"asst-debug","data-testid":"assistant-layout-toggle",children:[m("summary",{children:"Layout"}),m("div",{"data-testid":"layout-section",children:t?m("pre",{"data-testid":"assistant-layout-json",children:JSON.stringify(t,null,2)}):m("div",{style:"padding: 1rem; color: #94a3b8;","data-testid":"assistant-layout-empty",children:["Loading layout model...",m("button",{type:"button",class:"btn-sm",onClick:K,style:"margin-left: 0.5rem;","data-testid":"assistant-layout-refresh",children:"Refresh"})]})})]})]}),m("button",{id:"dock-tab",class:"dock-tab","aria-controls":"assistant-panel","aria-expanded":"false",title:"Expand (C)","data-testid":"dock-tab",children:"Chat"})]})}const Te=document.getElementById("assistant-root");Te&&(ze(m($t,{}),Te),kt());
//# sourceMappingURL=main-BpmJYbr0.js.map
