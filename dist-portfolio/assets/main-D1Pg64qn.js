var Be=Object.defineProperty;var Je=(t,e,n)=>e in t?Be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var j=(t,e,n)=>Je(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const _ of o.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Ke="layout:update",Ce={recipe:null};async function ee(){try{const t=await fetch("/api/layout",{credentials:"include"});if(!t.ok){console.warn(`Layout API returned ${t.status}, using defaults`);return}const e=await t.json();Ce.recipe=e,Ye(e),window.dispatchEvent(new CustomEvent(Ke,{detail:e}))}catch(t){console.warn("Failed to load layout recipe:",t)}}function Ve(){return Ce.recipe}function Ye(t){Object.entries(t.cards).forEach(([e,n])=>{const r=document.querySelector(`[data-card="${e}"]`);if(!r){console.debug(`Card not found: ${e}`);return}n.order!==void 0&&(r.style.order=String(n.order)),n.size?r.setAttribute("data-size",n.size):r.removeAttribute("data-size"),n.hidden?r.setAttribute("hidden",""):r.removeAttribute("hidden")})}const Le="admin:enabled";function Ge(){const t=new URL(location.href);if(t.searchParams.has("admin")){const e=t.searchParams.get("admin"),n=e===""||e==="1"||(e==null?void 0:e.toLowerCase())==="true";localStorage.setItem(Le,n?"1":"0"),n&&history.replaceState(null,"",t.pathname+t.hash)}}function Qe(){return!1&&localStorage.getItem(Le)==="1"}async function Xe(){try{const t=await fetch("/api/auth/me",{credentials:"include"});return t.ok?await t.json():null}catch{return null}}function Ze(t){var n,r;const e=((n=t==null?void 0:t.user)==null?void 0:n.roles)||[];return((r=t==null?void 0:t.user)==null?void 0:r.is_admin)===!0||e.includes("admin")||e.includes("owner")}let z=null;async function ce(){if(Qe())return!0;const t=Date.now();if(z&&t-z.at<1e4)return z.val;const e=await Xe(),n=Ze(e);return z={at:t,val:n},n}class et{constructor(){j(this,"projects",[]);j(this,"currentFilter","all");j(this,"gridContainer");j(this,"loadingElement",null);j(this,"emptyElement");j(this,"observer");if(this.gridContainer=document.getElementById("portfolio-grid"),this.emptyElement=document.getElementById("portfolio-empty"),!this.gridContainer||!this.emptyElement){console.warn("Portfolio elements not found");return}this.loadingElement=this.gridContainer.querySelector(".portfolio-loading"),this.observer=new IntersectionObserver(e=>{e.forEach(n=>{if(n.isIntersecting){const r=n.target,s=r.dataset.src;s&&(r.src=s,r.removeAttribute("data-src"),this.observer.unobserve(r))}})},{rootMargin:"50px"}),this.setupFilterListeners(),this.loadProjects()}setupFilterListeners(){const e=document.querySelectorAll(".filter-btn");e.forEach(n=>{n.addEventListener("click",r=>{const s=r.currentTarget,o=s.dataset.filter||"all";e.forEach(_=>_.classList.remove("active")),s.classList.add("active"),this.currentFilter=o,this.renderProjects()})})}async loadProjects(){try{const e=await fetch("/projects.json");if(!e.ok)throw new Error(`Failed to fetch projects: ${e.status}`);const n=await e.json();this.projects=Object.values(n),console.log(`Loaded ${this.projects.length} projects`),this.renderProjects()}catch(e){console.error("Error loading projects:",e),this.showEmpty()}}renderProjects(){if(!this.gridContainer)return;this.gridContainer.innerHTML="";const e=this.currentFilter==="all"?this.projects:this.projects.filter(r=>r.tags.some(s=>s.toLowerCase().includes(this.currentFilter.toLowerCase())));if(console.log(`Rendering ${e.length} projects (filter: ${this.currentFilter})`),e.length===0){this.showEmpty();return}this.emptyElement&&(this.emptyElement.style.display="none"),e.forEach((r,s)=>{const o=this.createProjectCard(r,s);this.gridContainer.appendChild(o)}),this.gridContainer.querySelectorAll("img[data-src]").forEach(r=>this.observer.observe(r))}createProjectCard(e,n){const r=document.createElement("div");r.className="project-card",r.style.animationDelay=`${n*.05}s`,r.setAttribute("data-card",e.slug);const s=e.thumbnail||"/placeholder.svg",o=this.escapeHtml(e.title),_=this.escapeHtml(e.description||e.problem||"No description available."),a=e.tags.slice(0,4).map(l=>`<span class="project-tag">${this.escapeHtml(l)}</span>`).join("");let c="";return e.demo&&(c=`
        <a href="${e.demo}" target="_blank" rel="noopener noreferrer" class="project-link">
          View Project →
        </a>
      `),r.innerHTML=`
      <div class="project-thumbnail">
        <img data-src="${s}" alt="${o}" loading="lazy" />
      </div>
      <div class="project-content">
        <h3 class="project-title">${o}</h3>
        ${a?`<div class="project-tags">${a}</div>`:""}
        <p class="project-description">${_}</p>
        ${c}
      </div>
    `,r}showEmpty(){!this.gridContainer||!this.emptyElement||(this.gridContainer.innerHTML="",this.emptyElement.style.display="block")}escapeHtml(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{console.log("Portfolio UI initialized"),new et});Ge();ee();window.addEventListener("layout:update",t=>{console.log("Layout loaded:",t.detail)});console.log("Portfolio shell initialized");var Q,v,Pe,M,ue,Ae,Te,He,se,te,ne,O={},je=[],tt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,X=Array.isArray;function T(t,e){for(var n in e)t[n]=e[n];return t}function ie(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function nt(t,e,n){var r,s,o,_={};for(o in e)o=="key"?r=e[o]:o=="ref"?s=e[o]:_[o]=e[o];if(arguments.length>2&&(_.children=arguments.length>3?Q.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)_[o]===void 0&&(_[o]=t.defaultProps[o]);return q(t,_,r,s,null)}function q(t,e,n,r,s){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Pe,__i:-1,__u:0};return s==null&&v.vnode!=null&&v.vnode(o),o}function I(t){return t.children}function B(t,e){this.props=t,this.context=e}function U(t,e){if(e==null)return t.__?U(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?U(t):null}function Ne(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Ne(t)}}function de(t){(!t.__d&&(t.__d=!0)&&M.push(t)&&!V.__r++||ue!=v.debounceRendering)&&((ue=v.debounceRendering)||Ae)(V)}function V(){for(var t,e,n,r,s,o,_,a=1;M.length;)M.length>a&&M.sort(Te),t=M.shift(),a=M.length,t.__d&&(n=void 0,r=void 0,s=(r=(e=t).__v).__e,o=[],_=[],e.__P&&((n=T({},r)).__v=r.__v+1,v.vnode&&v.vnode(n),_e(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[s]:null,o,s??U(r),!!(32&r.__u),_),n.__v=r.__v,n.__.__k[n.__i]=n,Ue(o,n,_),r.__e=r.__=null,n.__e!=s&&Ne(n)));V.__r=0}function Me(t,e,n,r,s,o,_,a,c,l,h){var i,p,d,$,L,x,m,y=r&&r.__k||je,P=e.length;for(c=rt(n,e,y,c,P),i=0;i<P;i++)(d=n.__k[i])!=null&&(p=d.__i==-1?O:y[d.__i]||O,d.__i=i,x=_e(t,d,p,s,o,_,a,c,l,h),$=d.__e,d.ref&&p.ref!=d.ref&&(p.ref&&le(p.ref,null,d),h.push(d.ref,d.__c||$,d)),L==null&&$!=null&&(L=$),(m=!!(4&d.__u))||p.__k===d.__k?c=Fe(d,c,t,m):typeof d.type=="function"&&x!==void 0?c=x:$&&(c=$.nextSibling),d.__u&=-7);return n.__e=L,c}function rt(t,e,n,r,s){var o,_,a,c,l,h=n.length,i=h,p=0;for(t.__k=new Array(s),o=0;o<s;o++)(_=e[o])!=null&&typeof _!="boolean"&&typeof _!="function"?(c=o+p,(_=t.__k[o]=typeof _=="string"||typeof _=="number"||typeof _=="bigint"||_.constructor==String?q(null,_,null,null,null):X(_)?q(I,{children:_},null,null,null):_.constructor==null&&_.__b>0?q(_.type,_.props,_.key,_.ref?_.ref:null,_.__v):_).__=t,_.__b=t.__b+1,a=null,(l=_.__i=ot(_,n,c,i))!=-1&&(i--,(a=n[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(s>h?p--:s<h&&p++),typeof _.type!="function"&&(_.__u|=4)):l!=c&&(l==c-1?p--:l==c+1?p++:(l>c?p--:p++,_.__u|=4))):t.__k[o]=null;if(i)for(o=0;o<h;o++)(a=n[o])!=null&&!(2&a.__u)&&(a.__e==r&&(r=U(a)),De(a,a));return r}function Fe(t,e,n,r){var s,o;if(typeof t.type=="function"){for(s=t.__k,o=0;s&&o<s.length;o++)s[o]&&(s[o].__=t,e=Fe(s[o],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=U(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function ot(t,e,n,r){var s,o,_,a=t.key,c=t.type,l=e[n],h=l!=null&&(2&l.__u)==0;if(l===null&&t.key==null||h&&a==l.key&&c==l.type)return n;if(r>(h?1:0)){for(s=n-1,o=n+1;s>=0||o<e.length;)if((l=e[_=s>=0?s--:o++])!=null&&!(2&l.__u)&&a==l.key&&c==l.type)return _}return-1}function fe(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||tt.test(e)?n:n+"px"}function W(t,e,n,r,s){var o,_;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||fe(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||fe(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(He,"$1")),_=e.toLowerCase(),e=_ in t||e=="onFocusOut"||e=="onFocusIn"?_.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r?n.u=r.u:(n.u=se,t.addEventListener(e,o?ne:te,o)):t.removeEventListener(e,o?ne:te,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function he(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=se++;else if(e.t<n.u)return;return n(v.event?v.event(e):e)}}}function _e(t,e,n,r,s,o,_,a,c,l){var h,i,p,d,$,L,x,m,y,P,A,F,H,R,u,f,g,b=e.type;if(e.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),o=[a=e.__e=n.__e]),(h=v.__b)&&h(e);e:if(typeof b=="function")try{if(m=e.props,y="prototype"in b&&b.prototype.render,P=(h=b.contextType)&&r[h.__c],A=h?P?P.props.value:h.__:r,n.__c?x=(i=e.__c=n.__c).__=i.__E:(y?e.__c=i=new b(m,A):(e.__c=i=new B(m,A),i.constructor=b,i.render=it),P&&P.sub(i),i.props=m,i.state||(i.state={}),i.context=A,i.__n=r,p=i.__d=!0,i.__h=[],i._sb=[]),y&&i.__s==null&&(i.__s=i.state),y&&b.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=T({},i.__s)),T(i.__s,b.getDerivedStateFromProps(m,i.__s))),d=i.props,$=i.state,i.__v=e,p)y&&b.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),y&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(y&&b.getDerivedStateFromProps==null&&m!==d&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(m,A),!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(m,i.__s,A)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(i.props=m,i.state=i.__s,i.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(S){S&&(S.__=e)}),F=0;F<i._sb.length;F++)i.__h.push(i._sb[F]);i._sb=[],i.__h.length&&_.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(m,i.__s,A),y&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(d,$,L)})}if(i.context=A,i.props=m,i.__P=t,i.__e=!1,H=v.__r,R=0,y){for(i.state=i.__s,i.__d=!1,H&&H(e),h=i.render(i.props,i.state,i.context),u=0;u<i._sb.length;u++)i.__h.push(i._sb[u]);i._sb=[]}else do i.__d=!1,H&&H(e),h=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++R<25);i.state=i.__s,i.getChildContext!=null&&(r=T(T({},r),i.getChildContext())),y&&!p&&i.getSnapshotBeforeUpdate!=null&&(L=i.getSnapshotBeforeUpdate(d,$)),f=h,h!=null&&h.type===I&&h.key==null&&(f=Oe(h.props.children)),a=Me(t,X(f)?f:[f],e,n,r,s,o,_,a,c,l),i.base=e.__e,e.__u&=-161,i.__h.length&&_.push(i),x&&(i.__E=i.__=null)}catch(S){if(e.__v=null,c||o!=null)if(S.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,e.__e=a}else{for(g=o.length;g--;)ie(o[g]);re(e)}else e.__e=n.__e,e.__k=n.__k,S.then||re(e);v.__e(S,e,n)}else o==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=st(n.__e,e,n,r,s,o,_,c,l);return(h=v.diffed)&&h(e),128&e.__u?void 0:a}function re(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(re)}function Ue(t,e,n){for(var r=0;r<n.length;r++)le(n[r],n[++r],n[++r]);v.__c&&v.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(o){o.call(s)})}catch(o){v.__e(o,s.__v)}})}function Oe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:X(t)?t.map(Oe):T({},t)}function st(t,e,n,r,s,o,_,a,c){var l,h,i,p,d,$,L,x=n.props,m=e.props,y=e.type;if(y=="svg"?s="http://www.w3.org/2000/svg":y=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(l=0;l<o.length;l++)if((d=o[l])&&"setAttribute"in d==!!y&&(y?d.localName==y:d.nodeType==3)){t=d,o[l]=null;break}}if(t==null){if(y==null)return document.createTextNode(m);t=document.createElementNS(s,y,m.is&&m),a&&(v.__m&&v.__m(e,o),a=!1),o=null}if(y==null)x===m||a&&t.data==m||(t.data=m);else{if(o=o&&Q.call(t.childNodes),x=n.props||O,!a&&o!=null)for(x={},l=0;l<t.attributes.length;l++)x[(d=t.attributes[l]).name]=d.value;for(l in x)if(d=x[l],l!="children"){if(l=="dangerouslySetInnerHTML")i=d;else if(!(l in m)){if(l=="value"&&"defaultValue"in m||l=="checked"&&"defaultChecked"in m)continue;W(t,l,null,d,s)}}for(l in m)d=m[l],l=="children"?p=d:l=="dangerouslySetInnerHTML"?h=d:l=="value"?$=d:l=="checked"?L=d:a&&typeof d!="function"||x[l]===d||W(t,l,d,x[l],s);if(h)a||i&&(h.__html==i.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(i&&(t.innerHTML=""),Me(e.type=="template"?t.content:t,X(p)?p:[p],e,n,r,y=="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,_,o?o[0]:n.__k&&U(n,0),a,c),o!=null)for(l=o.length;l--;)ie(o[l]);a||(l="value",y=="progress"&&$==null?t.removeAttribute("value"):$!=null&&($!==t[l]||y=="progress"&&!$||y=="option"&&$!=x[l])&&W(t,l,$,x[l],s),l="checked",L!=null&&L!=t[l]&&W(t,l,L,x[l],s))}return t}function le(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(s){v.__e(s,n)}}function De(t,e,n){var r,s;if(v.unmount&&v.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||le(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){v.__e(o,e)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&De(r[s],e,n||typeof t.type!="function");n||ie(t.__e),t.__c=t.__=t.__e=void 0}function it(t,e,n){return this.constructor(t,n)}function _t(t,e,n){var r,s,o,_;e==document&&(e=document.documentElement),v.__&&v.__(t,e),s=(r=!1)?null:e.__k,o=[],_=[],_e(e,t=e.__k=nt(I,null,[t]),s||O,O,e.namespaceURI,s?null:e.firstChild?Q.call(e.childNodes):null,o,s?s.__e:e.firstChild,r,_),Ue(o,t,_)}Q=je.slice,v={__e:function(t,e,n,r){for(var s,o,_;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(t)),_=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),_=s.__d),_)return s.__E=s}catch(a){t=a}throw t}},Pe=0,B.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=T({},this.state),typeof t=="function"&&(t=t(T({},n),this.props)),t&&T(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),de(this))},B.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),de(this))},B.prototype.render=I,M=[],Ae=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Te=function(t,e){return t.__v.__b-e.__v.__b},V.__r=0,He=/(PointerCapture)$|Capture$/i,se=0,te=he(!1),ne=he(!0);var lt=0;function w(t,e,n,r,s,o){e||(e={});var _,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?_=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:_,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--lt,__i:-1,__u:0,__source:s,__self:o};if(typeof t=="function"&&(_=t.defaultProps))for(a in _)c[a]===void 0&&(c[a]=_[a]);return v.vnode&&v.vnode(l),l}var D,E,Z,pe,Y=0,Ie=[],k=v,me=k.__b,ye=k.__r,ve=k.diffed,ge=k.__c,be=k.unmount,we=k.__;function ae(t,e){k.__h&&k.__h(E,t,Y||e),Y=0;var n=E.__H||(E.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function N(t){return Y=1,at(We,t)}function at(t,e,n){var r=ae(D++,2);if(r.t=t,!r.__c&&(r.__=[We(void 0,e),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=E,!E.__f)){var s=function(a,c,l){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!o||o.call(this,a,c,l);var i=r.__c.props!==a;return h.forEach(function(p){if(p.__N){var d=p.__[0];p.__=p.__N,p.__N=void 0,d!==p.__[0]&&(i=!0)}}),o&&o.call(this,a,c,l)||i};E.__f=!0;var o=E.shouldComponentUpdate,_=E.componentWillUpdate;E.componentWillUpdate=function(a,c,l){if(this.__e){var h=o;o=void 0,s(a,c,l),o=h}_&&_.call(this,a,c,l)},E.shouldComponentUpdate=s}return r.__N||r.__}function J(t,e){var n=ae(D++,3);!k.__s&&ze(n.__H,e)&&(n.__=t,n.u=e,E.__H.__h.push(n))}function G(t){return Y=5,Re(function(){return{current:t}},[])}function Re(t,e){var n=ae(D++,7);return ze(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function ct(){for(var t;t=Ie.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(K),t.__H.__h.forEach(oe),t.__H.__h=[]}catch(e){t.__H.__h=[],k.__e(e,t.__v)}}k.__b=function(t){E=null,me&&me(t)},k.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),we&&we(t,e)},k.__r=function(t){ye&&ye(t),D=0;var e=(E=t.__c).__H;e&&(Z===E?(e.__h=[],E.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(K),e.__h.forEach(oe),e.__h=[],D=0)),Z=E},k.diffed=function(t){ve&&ve(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ie.push(e)!==1&&pe===k.requestAnimationFrame||((pe=k.requestAnimationFrame)||ut)(ct)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Z=E=null},k.__c=function(t,e){e.some(function(n){try{n.__h.forEach(K),n.__h=n.__h.filter(function(r){return!r.__||oe(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],k.__e(r,n.__v)}}),ge&&ge(t,e)},k.unmount=function(t){be&&be(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{K(r)}catch(s){e=s}}),n.__H=void 0,e&&k.__e(e,n.__v))};var xe=typeof requestAnimationFrame=="function";function ut(t){var e,n=function(){clearTimeout(r),xe&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);xe&&(e=requestAnimationFrame(n))}function K(t){var e=E,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),E=e}function oe(t){var e=E;t.__c=t.__(),E=e}function ze(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function We(t,e){return typeof e=="function"?e(t):e}const Ee="layout:update";function C(){return Date.now()}function $e(t){return new Date(t).toLocaleTimeString()}function dt(){var e;const t=(e=crypto==null?void 0:crypto.randomUUID)==null?void 0:e.call(crypto);return t||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=Math.random()*16|0;return(n==="x"?r:r&3|8).toString(16)})}function ke(t,e,n,r){const s=G(null),o=G(1e3);J(()=>{let _=!1;const a=()=>{if(!_)try{const c=new EventSource(t,{withCredentials:!0});s.current=c,c.onopen=()=>{o.current=1e3,n==null||n()},c.onmessage=l=>e(l.data),c.onerror=()=>{c.close(),s.current=null;const l=Math.min(o.current,15e3)+Math.floor(Math.random()*500);o.current=Math.min(o.current*2,15e3),setTimeout(a,l)}}catch{const c=Math.min(o.current,15e3)+Math.floor(Math.random()*500);o.current=Math.min(o.current*2,15e3),setTimeout(a,c)}};return a(),()=>{var c;_=!0,(c=s.current)==null||c.close(),s.current=null}},[t,r])}function ft(){const[t,e]=N(Ve()),[n,r]=N([{role:"system",text:"Assistant ready. Type below and press Enter.",ts:C()}]),[s,o]=N(""),[_]=N(()=>dt()),[a,c]=N(!1),[l,h]=N(!1),[i,p]=N(!0),d=G(null);J(()=>{(async()=>h(await ce()))();const u=async()=>h(await ce());return window.addEventListener("focus",u),()=>window.removeEventListener("focus",u)},[]),J(()=>{const u=f=>e(f.detail);return window.addEventListener(Ee,u),()=>window.removeEventListener(Ee,u)},[]),J(()=>{const u=d.current;u&&(u.scrollTop=u.scrollHeight)},[n]);const $=Re(()=>u=>{try{const f=JSON.parse(u),g=f.role??"assistant",b=typeof f.text=="string"?f.text:JSON.stringify(f);r(S=>[...S,{role:g,text:b,ts:C()}])}catch{r(f=>[...f,{role:"assistant",text:u,ts:C()}])}},[]);ke("/agent/events",$,()=>{r(u=>[...u,{role:"event",text:"[events] connected",ts:C()}])},"agent");const L=`chat:${_}`,x=G(null),m=()=>{r(u=>[...u,{role:"event",text:`[chat] stream connected (${_})`,ts:C()}])},y=u=>{if(u==="[DONE]"){c(!1),r(f=>[...f,{role:"event",text:"[chat] done",ts:C()}]),x.current=null;return}try{const f=JSON.parse(u);if(typeof(f==null?void 0:f.text)=="string"){P(f.text);return}r(g=>[...g,{role:"event",text:u,ts:C()}])}catch{P(u)}};function P(u){r(f=>{let g=x.current,b=[...f];return g==null?(g=b.length,x.current=g,b.push({role:"assistant",text:u,ts:C()})):b[g]={...b[g],text:b[g].text+u,ts:b[g].ts},b})}ke(`/chat/stream?channel=${encodeURIComponent(_)}`,y,m,L);async function A(u){const f=u.trim();if(f){r(g=>[...g,{role:"user",text:f,ts:C()}]),o(""),c(!0);try{const g=await fetch("/chat",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,channel:_})});if(!g.ok){c(!1),r(S=>[...S,{role:"event",text:`[chat] ${g.status} ${g.statusText}`,ts:C()}]);return}const b=g.headers.get("content-type")||"";if(b.includes("application/json")){const S=await g.json(),qe=typeof(S.reply??S.text)=="string"?S.reply??S.text:JSON.stringify(S);P(qe),c(!1)}else if(b.startsWith("text/")){const S=await g.text();P(S),c(!1)}}catch(g){c(!1),r(b=>[...b,{role:"event",text:`[chat] error: ${String(g)}`,ts:C()}])}}}function F(u){u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),A(s))}async function H(){try{const u=await fetch("/api/layout/autotune",{method:"POST",credentials:"include"});if(!u.ok){r(f=>[...f,{role:"event",text:`[autotune] ${u.status} ${u.statusText}`,ts:C()}]);return}r(f=>[...f,{role:"event",text:"[autotune] layout optimized",ts:C()}]),await ee()}catch(u){r(f=>[...f,{role:"event",text:`[autotune] error: ${String(u)}`,ts:C()}])}}async function R(){try{const u=await fetch("/api/layout/reset",{method:"POST",credentials:"include"});if(!u.ok){r(f=>[...f,{role:"event",text:`[reset] ${u.status} ${u.statusText}`,ts:C()}]);return}r(f=>[...f,{role:"event",text:"[reset] layout reset to default",ts:C()}]),await ee()}catch(u){r(f=>[...f,{role:"event",text:`[reset] error: ${String(u)}`,ts:C()}])}}return w("div",{class:`assistant-panel${i?"":" hidden"}`,"data-testid":"assistant-panel",children:[w("div",{class:"hdr",style:"display:flex; align-items:center; gap:.5rem; justify-content:space-between;",children:[w("div",{style:"display:flex; align-items:center; gap:.5rem;",children:[w("div",{style:"font-weight:600;",children:"Portfolio Assistant"}),l&&w("span",{class:"asst-badge-admin",children:"admin"})]}),w("div",{class:"asst-controls",style:"display:flex; gap:.25rem;",children:[l&&w(I,{children:[w("button",{class:"btn-sm",onClick:H,title:"Admin only: Autotune layout","data-testid":"btn-autotune",children:"Autotune"}),w("button",{class:"btn-sm",onClick:R,title:"Admin only: Reset layout","data-testid":"btn-reset",children:"Reset"})]}),w("button",{class:"btn-sm",onClick:()=>p(!1),title:"Hide panel",children:"Hide"})]})]}),w("div",{ref:d,class:"asst-log","data-testid":"assistant-log",children:[n.map((u,f)=>w("div",{class:`row ${u.role}`,children:[w("span",{class:"ts",children:$e(u.ts)}),w("span",{class:"bubble",children:u.text})]},f)),a&&w("div",{class:"row event",children:[w("span",{class:"ts",children:$e(C())}),w("span",{class:"bubble",children:"…streaming"})]})]}),w("div",{class:"asst-compose",children:[w("textarea",{"aria-label":"Message",placeholder:"Type a message…",value:s,onInput:u=>o(u.currentTarget.value),onKeyDown:u=>F(u),rows:1}),w("button",{class:"btn",onClick:()=>void A(s),disabled:a,"data-testid":"assistant-send",children:a?"Sending…":"Send"})]}),w("details",{class:"asst-debug",children:[w("summary",{children:"Layout"}),w("pre",{children:JSON.stringify(t,null,2)})]})]})}const Se=document.getElementById("assistant-root");Se&&_t(w(ft,{}),Se);
//# sourceMappingURL=main-D1Pg64qn.js.map
